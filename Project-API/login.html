<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOGINPAGE</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"
      integrity="sha512-oHDEc8Xed4hiW6CxD7qjbnI+B07vDdX7hEPTvn9pSZO1bcRqHp8mj9pyr+8RVC2GmtEfI2Bi9Ke9Ass0as+zpg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/parse/3.5.1/parse.min.js"
      integrity="sha512-K5UvqoTmWuS3zAUrjlHkDvcKVqiLTIkNIjIegNj+JgzNeqh4yaDUubGaSctred2epsMz4MIrIPpUbOyiZom+Ag=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <header class="header">
      <div class="logo-container">
        <div>LOG</div>
        <div class="header-text">IN</div>
      </div>
      <div>
        <form class="form-logout" role="form">
          <input type="submit" value="Logout" id="logout" />
        </form>
      </div>
    </header>
    <main>
      <div>
        <div id="user-container"></div>
        <!-- <input type="file" name="" id="fileId" onchange="imageUploaded()" />

        <br /><br />

        <button onclick="displayString()">Display String</button>

        <form>
          <label>Name:</label>

          <input type="text" required />

          <label>Email:</label>

          <input type="email" required />

          <button style="margin-top: 5px">Submit</button>
        </form> -->
      </div>
    </main>
    <script>
      //LogOut ->
      jQuery(document).ready(function () {
        Parse.$ = jQuery;
        Parse.initialize("...", "...");

        $(".form-logout").on("submit", function (e) {
          e.preventDefault();
          console.log("Performing submit");
          if (Parse.User.current()) {
            Parse.User.logOut();
            if (Parse.User.current()) console.log("Failed to log out!");
          }
          sessionStorage.clear();
          window.location.href = "index.html";
        });
      });

      const id = sessionStorage.getItem("userId");

      fetch("https://localhost:7121/Person?id=" + id, {
        method: "GET",
        headers: {
          Accept: "text/json",
          "Content-Type": "application/json",
        },
      })
        .then((res) => res.json())
        .then((data) => {
          renderUserInfo(data);
        });

      fetch("https://localhost:7121/Address?id=" + id, {
        method: "GET",
        headers: {
          Accept: "text/json",
          "Content-Type": "application/json",
        },
      })
        .then((res) => res.json())
        .then((data) => {
          if (data == "undefined") {
            alert("Duomenu nera");
          } else {
            renderUserAddress(data);
          }
        });

      function renderUserInfo(user) {
        const userContainer = document.getElementById("user-container");
        userContainer.innerHTML = "";
        const userCard = document.createElement("div");
        userCard.setAttribute("class", "card");
        const profilePictureDiv = document.createElement("div");
        profilePictureDiv.setAttribute("class", "profilePciture");
        const image = document.createElement("img");
        image.src = "data:image/png;base64," + user.image;
        profilePictureDiv.append(image);
        const userNameAndSurname = document.createElement("div");
        userNameAndSurname.setAttribute("class", "userNameAndSurname");
        const userName = document.createElement("div");
        userName.textContent = user.name;
        const userSurname = document.createElement("div");
        userSurname.textContent = user.surname;
        userNameAndSurname.append(userName, userSurname);
        const userInfo = document.createElement("div");
        userInfo.setAttribute("class", "userInfo");
        const personalId = document.createElement("div");
        personalId.textContent = "Personal ID: " + user.personalId;
        const phone = document.createElement("div");
        phone.textContent = "Phone: " + user.phone;
        const email = document.createElement("div");
        email.textContent = "Email: " + user.email;
        const address = document.createElement("div");
        address.setAttribute("id", "address");
        address.innerText = "Address:";
        userInfo.append(personalId, phone, email, address);
        userCard.append(profilePictureDiv, userNameAndSurname);

        userContainer.append(userCard, userInfo);
      }

      function renderUserAddress(user) {
        const userAddressContainer = document.getElementById("address");

        const city = document.createElement("div");
        city.textContent = "City: " + user.city;
        const street = document.createElement("div");
        street.textContent = "Street: " + user.street;
        const streetNumber = document.createElement("div");
        streetNumber.textContent = "Street No: " + user.streetNumber;
        const houseNumber = document.createElement("div");
        houseNumber.textContent = "Home No: " + user.houseNumber;
        userAddressContainer.append(city, street, streetNumber, houseNumber);
      }
      let base64String = "";

      function imageUploaded() {
        var file = document.querySelector("input[type=file]")["files"][0];

        var reader = new FileReader();

        console.log("next");

        reader.onload = function () {
          base64String = reader.result.replace("data:", "").replace(/^.+,/, "");

          imageBase64Stringsep = base64String;

          // alert(imageBase64Stringsep);

          console.log(base64String);
        };

        reader.readAsDataURL(file);
      }

      function displayString() {
        console.log("Base64String about to be printed");

        alert(base64String);
      }
    </script>
  </body>
</html>
