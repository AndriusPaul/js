<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOGINPAGE</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"
      integrity="sha512-oHDEc8Xed4hiW6CxD7qjbnI+B07vDdX7hEPTvn9pSZO1bcRqHp8mj9pyr+8RVC2GmtEfI2Bi9Ke9Ass0as+zpg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/parse/3.5.1/parse.min.js"
      integrity="sha512-K5UvqoTmWuS3zAUrjlHkDvcKVqiLTIkNIjIegNj+JgzNeqh4yaDUubGaSctred2epsMz4MIrIPpUbOyiZom+Ag=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <header class="header">
      <div class="logo-container">
        <div>LOG</div>
        <div class="header-text">IN</div>
      </div>
      <div>
        <form class="form-logout" role="form">
          <input type="submit" value="Logout" id="logout" />
        </form>
      </div>
    </header>
    <main>
      <div>
        <div id="user-container"></div>
        <div id="address"></div>
      </div>
    </main>
    <script defer>
      const id = sessionStorage.getItem("userId");
      const role = sessionStorage.getItem("role");

      CheckUserRole(id, role);

      function CheckUserRole(id, role) {
        if (role == "user") {
          RenderRoleUser(id);
        } else if (role == "admin") {
          RenderRoleAdmin();
        }
      }
      function RenderRoleUser(id) {
        fetch("https://localhost:7121/Address?id=" + id, {
          method: "GET",
          headers: {
            Accept: "text/json",
            "Content-Type": "application/json",
          },
        })
          .then((res) => res.json())
          .then((data) => {
            RenderUserAddress(data);
          });

        fetch("https://localhost:7121/Person?id=" + id, {
          method: "GET",
          headers: {
            Accept: "text/json",
            "Content-Type": "application/json",
          },
        })
          .then((res) => res.json())
          .then((data) => {
            RenderUserInfo(data);
          });

        function RenderUserInfo(user) {
          const userContainer = document.getElementById("user-container");
          userContainer.innerHTML = "";
          const userCard = document.createElement("div");
          userCard.setAttribute("class", "card");
          const profilePictureDiv = document.createElement("div");
          profilePictureDiv.setAttribute("class", "profilePciture");
          const image = document.createElement("img");
          image.src = "data:image/png;base64," + user.image;
          profilePictureDiv.append(image);
          const userNameAndSurname = document.createElement("div");
          userNameAndSurname.setAttribute("class", "userNameAndSurname");
          const userName = document.createElement("div");
          userName.textContent = user.name;
          const userSurname = document.createElement("div");
          userSurname.textContent = user.surname;
          userNameAndSurname.append(userName, userSurname);
          const userInfo = document.createElement("div");
          userInfo.setAttribute("class", "userInfo");
          const personalId = document.createElement("div");
          personalId.textContent = "Personal ID: " + user.personalId;
          const phone = document.createElement("div");
          phone.textContent = "Phone: " + user.phone;
          const email = document.createElement("div");
          email.textContent = "Email: " + user.email;

          userInfo.append(personalId, phone, email, address);
          userCard.append(profilePictureDiv, userNameAndSurname);

          userContainer.append(userCard, userInfo);
        }

        function RenderUserAddress(user) {
          const userAddressContainer = document.getElementById("address");
          address.innerText = "Address:";
          const city = document.createElement("div");
          city.textContent = "City: " + user.city;
          const street = document.createElement("div");
          street.textContent = "Street: " + user.street;
          const streetNumber = document.createElement("div");
          streetNumber.textContent = "Street No: " + user.streetNumber;
          const houseNumber = document.createElement("div");
          houseNumber.textContent = "Home No: " + user.houseNumber;
          userAddressContainer.append(city, street, streetNumber, houseNumber);
        }
      }
      function RenderRoleAdmin() {
        fetch("https://localhost:7121/api/UserTwo/allInfo", {
          method: "GET",
          headers: {
            Accept: "text/json",
            "Content-Type": "application/json",
          },
        })
          .then((res) => res.json())
          .then((data) => {
            console.log(data);
            RenderUsers(data);
          });

        function RenderUsers(users) {
          const userContainer = document.getElementById("user-container");
          userContainer.innerHTML = "";
          users.forEach((user) => {
            const cardContainer = document.createElement("div");
            cardContainer.setAttribute("class", "card-container");

            const userCard = document.createElement("div");
            userCard.setAttribute("class", "card");
            const profilePictureDiv = document.createElement("div");
            profilePictureDiv.setAttribute("class", "profilePciture");
            const image = document.createElement("img");
            image.src = "data:image/png;base64," + user.person.image;
            profilePictureDiv.append(image);
            const userNameAndSurname = document.createElement("div");
            userNameAndSurname.setAttribute("class", "userNameAndSurname");
            const userName = document.createElement("div");
            userName.textContent = user.person.name;
            const userSurname = document.createElement("div");
            userSurname.textContent = user.person.surname;
            userNameAndSurname.append(userName, userSurname);
            const userInfo = document.createElement("div");
            userInfo.setAttribute("class", "userInfo");
            const username = document.createElement("div");
            username.textContent = "Username: " + user.username;
            username.style.color = "red";
            const password = document.createElement("div");
            password.textContent = "Password: " + user.password;
            const role = document.createElement("div");
            role.textContent = "Role: " + user.role;
            const personalId = document.createElement("div");
            personalId.textContent = "Personal ID: " + user.person.personalId;
            const phone = document.createElement("div");
            phone.textContent = "Phone: " + user.person.phone;
            const email = document.createElement("div");
            email.textContent = "Email: " + user.person.email;
            const userAddressContainer = document.getElementById("address");
            address.innerText = "Address:";
            address.style.color = "#2F80E1";
            const city = document.createElement("div");
            city.textContent = "City: " + user.address.city;
            const street = document.createElement("div");
            street.textContent = "Street: " + user.address.street;
            const streetNumber = document.createElement("div");
            streetNumber.textContent =
              "Street No: " + user.address.streetNumber;
            const houseNumber = document.createElement("div");
            houseNumber.textContent = "Home No: " + user.address.houseNumber;
            userAddressContainer.append(
              city,
              street,
              streetNumber,
              houseNumber
            );
            userInfo.append(
              username,
              password,
              role,
              personalId,
              phone,
              email,
              userAddressContainer
            );
            userCard.append(profilePictureDiv, userNameAndSurname);
            cardContainer.append(userCard, userInfo);
            userContainer.append(cardContainer);
          });
        }
      }

      //LogOut ->
      jQuery(document).ready(function () {
        Parse.$ = jQuery;
        Parse.initialize("...", "...");

        $(".form-logout").on("submit", function (e) {
          e.preventDefault();
          console.log("Performing submit");
          if (Parse.User.current()) {
            Parse.User.logOut();
            if (Parse.User.current()) console.log("Failed to log out!");
          }
          sessionStorage.clear();
          window.location.href = "index.html";
        });
      });
    </script>
  </body>
</html>
